build:
  portfolio:
    context: .

deploy:
  - envsubst < <(cat k8s/overlays/dev/secrets.env) > k8s/overlays/dev/secrets/secrets.env
  - cd k8s/overlays/dev && kustomize edit set image PORTFOLIO_IMAGE=${OKTETO_BUILD_PORTFOLIO_IMAGE} && kubectl apply -k .

dev:
  portfolio:
    image: $OKTETO_BUILD_PORTFOLIO_IMAGE
    command: bash
    sync:
      - src:/app
    forward:
      - 8000:8000
